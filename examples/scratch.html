<!DOCTYPE html>
<html>

<head>
    <title>cDOM | Scratchpad</title>
    <script src="../index.js"></script>
</head>

<body style="font-family: 'Inter', sans-serif; padding: 2rem; line-height: 1.6;">
    <script>
        const { $, _ } = cDOM;

        cDOM.helper('increment', (ref) => {
            if (ref && typeof ref === 'object' && 'value' in ref) ref.value++;
            else if (ref && typeof ref === 'object' && ref.count !== undefined) ref.count++;
            return ref;
        });

        cDOM.helper('log', (...args) => {
            console.log(...args);
            return args[0];
        });

        // Set global fallback using cDOM.state
        cDOM.state('Scratch App', { name: 'appName' });

        cDOM({
            div: {
                oncreate: {
                    "=state": [{ count: 10 }, { name: 'localCounter' }]
                },
                onmount: function () {
                    console.log('App mounted to DOM!', this);
                },
                children: [
                    { h1: "cDOM Scratchpad" },
                    "App Name: ", "=/appName", { br: {} },
                    "Local Counter (Scoped): ", "=/localCounter/count",
                    {
                        div: {
                            style: "margin: 1.5rem 0",
                            children: [
                                {
                                    button: {
                                        onclick: [
                                            { "=log": ["Starting array execution..."] },
                                            { "++": ["=/localCounter/count"] },
                                            { "=log": ["Counter is now:", "=/localCounter/count"] },
                                            { "set": ["=/appName", "cDOM Rocked!"] }
                                        ],
                                        children: ["Array Handler Demo"]
                                    }
                                }
                            ]
                        }
                    },
                    {
                        div: {
                            style: "background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;",
                            children: [
                                "This div can also see the local counter: ", "=/localCounter/count",
                                { br: {} },
                                { b: ["Math expression (count * 2 + 5): ", "=/localCounter/count * 2 + 5"] },
                                { hr: { style: "margin: 1.5rem 0; border: 0; border-top: 1px solid #e2e8f0;" } },
                                {
                                    div: {
                                        style: "font-size: 0.9em; color: #64748b; font-family: monospace;",
                                        children: [
                                            { div: ["XPath (Active Button Count): ", { "$": "count(//button)" }] },
                                            { div: ["XPath (Button Label): ", { "$": "//button/text()" }] },
                                            { div: ["Dynamic Helper { =sum: [1, 2, 3] }: ", { "=sum": [1, 2, 3] }] },
                                            { div: ["Dynamic Helper { =currency: [=/localCounter/count] }: ", { "=currency": ["=/localCounter/count"] }] },
                                            { div: ["Undefined Helper: ", { "=This.Should.Not.Exist": [] }] }
                                        ]
                                    }
                                }
                            ]
                        }
                    }
                ]
            }
        });
    </script>
</body>

</html>