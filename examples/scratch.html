<html>
<script src="../index.js"></script>

<body>
    <script>
        const { $, _ } = cDOM;
        cDOM.helper('increment', (ref) => {
            if (ref && typeof ref === 'object' && 'value' in ref) ref.value++;
            else if (ref && typeof ref === 'object' && ref.count !== undefined) ref.count++;
            return ref;
        });

        cDOM.helper('log', (...args) => {
            console.log(...args);
            return args[0];
        });

        // Set global fallback using cDOM.state
        cDOM.state('Scratch App', { name: 'appName' });

        cDOM({
            div: {
                oncreate: {
                    "=state": [{ count: 10 }, { name: 'localCounter' }]
                },
                onmount: function () {
                    console.log('App mounted to DOM!', this);
                },
                children: [
                    "App Name: ", { "=": "/appName" }, { br: {} },
                    "Local Counter (Scoped): ", { "=": "./localCounter/count" },
                    {
                        button: {
                            onclick: [
                                { "=log": ["Starting array execution..."] },
                                { "++": [{ "=": "./localCounter/count" }] },
                                { "=log": ["Counter is now:", { "=": "./localCounter/count" }] },
                                { "set": ["/appName", "cDOM Rocked!"] }
                            ],
                            children: ["Array Handler Demo"]
                        }
                    },
                    {
                        div: {
                            children: [
                                { br: {} },
                                "This div can also see the local counter: ", { "=": "./localCounter/count" },
                                { br: {} },
                                { br: {} },
                                "Math expression (count * 2 + 5): ", { "=": "./localCounter/count * 2 + 5" },
                                { br: {} },
                                { br: {} },
                                {
                                    div: {
                                        style: {
                                            "margin-top": "10px",
                                            "color": "#666",
                                            "font-size": "0.9em"
                                        },
                                        children: [
                                            "XPath (Active Button Count): ", { "$": "count(//button)" }, { br: {} },
                                            "XPath (Button Label): ", { "$": "//button/text()" }, { br: {} },
                                            "Dynamic Helper { =sum: [1, 2, 3] }: ", { "=sum": [1, 2, 3] }, { br: {} },
                                            "Dynamic Helper{ =currency: [{ =: ./localCounter/count }] }: ", { "=currency": [{ "=": "/localCounter/count" }] }, { br: {} },
                                            "Undefined Helper: ", { "=This.Should.Not.Exist": [] }
                                        ]
                                    }
                                }
                            ]
                        }
                    }
                ]
            }
        }, {})
    </script>
</body>

</html>